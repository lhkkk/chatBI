 * Serving Flask app 'backend_server'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on http://127.0.0.1:8001
Press CTRL+C to quit

  You can now view your Streamlit app in your browser.

  Local URL: http://localhost:8501
  Network URL: http://172.16.16.138:8501

/Users/kcol/Downloads/work/code/chatBI-1.1.0-develop/service/attribute_extraction_service.py:363: SyntaxWarning: invalid escape sequence '\s'
  customer_pattern = re.compile(r"(.*?" + keyword + ".*?)(?=流出|流入|流向|$|\s+的|\s+下)")
 * Serving Flask app 'main'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on http://127.0.0.1:8002
Press CTRL+C to quit
2026-01-19 16:03:28,655 - backend_server.py[line:28] - INFO - 请求体：{'session_id': '11111111111111', 'status_code': 100, 'user_input': '查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据\n\n', 'history_input': [{'role': 'assistant', 'content': '有什么可以帮你的吗？'}], 'primary_scene': '流量流向分析', 'secondary_scene': '', 'third_scene': '', 'intermediate_result': {}}
2026-01-19 16:03:28,655 - backend_server.py[line:28] - INFO - 请求体：{'session_id': '11111111111111', 'status_code': 100, 'user_input': '查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据\n\n', 'history_input': [{'role': 'assistant', 'content': '有什么可以帮你的吗？'}], 'primary_scene': '流量流向分析', 'secondary_scene': '', 'third_scene': '', 'intermediate_result': {}}
2026-01-19 16:03:28,666 - main.py[line:67] - INFO - 请求体：{'session_id': '11111111111111', 'status_code': 100, 'user_input': '查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据\n\n', 'history_input': [{'role': 'assistant', 'content': '有什么可以帮你的吗？'}], 'primary_scene': '流量流向分析', 'secondary_scene': '', 'third_scene': '', 'intermediate_result': {}, 'questions': [], 'time': ''}
2026-01-19 16:03:28,666 - main.py[line:67] - INFO - 请求体：{'session_id': '11111111111111', 'status_code': 100, 'user_input': '查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据\n\n', 'history_input': [{'role': 'assistant', 'content': '有什么可以帮你的吗？'}], 'primary_scene': '流量流向分析', 'secondary_scene': '', 'third_scene': '', 'intermediate_result': {}, 'questions': [], 'time': ''}
2026-01-19 16:03:28,666 - main.py[line:92] - INFO - 新会话/新任务，清空关键词
2026-01-19 16:03:28,666 - main.py[line:92] - INFO - 新会话/新任务，清空关键词
2026-01-19 16:03:28,667 - main.py[line:102] - INFO - 当前状态码：100，用户输入：查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据


2026-01-19 16:03:28,667 - main.py[line:102] - INFO - 当前状态码：100，用户输入：查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据


2026-01-19 16:03:32,031 - main.py[line:126] - INFO - 闲聊检测结果：非闲聊
2026-01-19 16:03:32,031 - main.py[line:126] - INFO - 闲聊检测结果：非闲聊
2026-01-19 16:03:32,565 - main.py[line:135] - INFO - 新任务判断结果：新任务
2026-01-19 16:03:32,565 - main.py[line:135] - INFO - 新任务判断结果：新任务
2026-01-19 16:03:32,565 - primary_scene_classification.py[line:125] - INFO - 开始一级场景分类，用户输入：查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据

，历史对话：[{'role': 'assistant', 'content': '有什么可以帮你的吗？'}]
2026-01-19 16:03:32,565 - primary_scene_classification.py[line:125] - INFO - 开始一级场景分类，用户输入：查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据

，历史对话：[{'role': 'assistant', 'content': '有什么可以帮你的吗？'}]
2026-01-19 16:03:32,566 - primary_scene_classification.py[line:129] - INFO - 场景映射配置：{'流量流向分析': ['地域流量分析', '客户流量分析', 'IP流量分析'], '异常流量分析': ['PCDN流量分析', '白手套流量分析', '拉流流量分析'], '流量成分分析': ['应用流量分析', '云业务流量分析', '异网IDC资源分析', '客户流量成分分析'], '闲聊': ['闲聊']}
2026-01-19 16:03:32,566 - primary_scene_classification.py[line:129] - INFO - 场景映射配置：{'流量流向分析': ['地域流量分析', '客户流量分析', 'IP流量分析'], '异常流量分析': ['PCDN流量分析', '白手套流量分析', '拉流流量分析'], '流量成分分析': ['应用流量分析', '云业务流量分析', '异网IDC资源分析', '客户流量成分分析'], '闲聊': ['闲聊']}
2026-01-19 16:03:33,133 - primary_scene_classification.py[line:141] - INFO - 大模型返回结果：流量流向分析
2026-01-19 16:03:33,133 - primary_scene_classification.py[line:141] - INFO - 大模型返回结果：流量流向分析
2026-01-19 16:03:33,133 - primary_scene_classification.py[line:159] - INFO - 一级场景分类结果：流量流向分析
2026-01-19 16:03:33,133 - primary_scene_classification.py[line:159] - INFO - 一级场景分类结果：流量流向分析
2026-01-19 16:03:33,133 - main.py[line:140] - INFO - 一级场景分类结果：流量流向分析
2026-01-19 16:03:33,133 - main.py[line:140] - INFO - 一级场景分类结果：流量流向分析
2026-01-19 16:03:33,133 - main.py[line:160] - INFO - 处理新会话/新任务，进入场景判断流程
2026-01-19 16:03:33,133 - main.py[line:160] - INFO - 处理新会话/新任务，进入场景判断流程
/Users/kcol/Downloads/work/code/chatBI-1.1.0-develop/service/scene_classification_service.py:479: LangChainDeprecationWarning: The class `LLMChain` was deprecated in LangChain 0.1.17 and will be removed in 1.0. Use `RunnableSequence, e.g., `prompt | llm`` instead.
  return LLMChain(llm=llm, prompt=prompt)
2026-01-19 16:03:33,329 - scene_classification_service.py[line:66] - INFO - 使用的关键词: ['地市', '025.11.29', '结算详情', '025.10.1']
2026-01-19 16:03:33,329 - scene_classification_service.py[line:66] - INFO - 使用的关键词: ['地市', '025.11.29', '结算详情', '025.10.1']
2026-01-19 16:03:33,330 - scene_classification_service.py[line:89] - INFO - 场景分类结果: 场景=地域流量分析, 状态码=200, 源端=['025.10.1', '025.11.29', '省内', '地市', '结算详情'], 目的端=['025.11.29', '省内', '地市', '结算详情']
2026-01-19 16:03:33,330 - scene_classification_service.py[line:89] - INFO - 场景分类结果: 场景=地域流量分析, 状态码=200, 源端=['025.10.1', '025.11.29', '省内', '地市', '结算详情'], 目的端=['025.11.29', '省内', '地市', '结算详情']
2026-01-19 16:03:33,330 - main.py[line:166] - INFO - 二级场景判断结果：{'status_code': 200, 'secondary_scene': '地域流量分析', 'prompt': '', 'intermediate_result': {'keywords': ['地市', '025.11.29', '结算详情', '025.10.1'], 'attributes': {'源端': ['025.10.1', '025.11.29', '省内', '地市', '结算详情'], '对端': ['025.11.29', '省内', '地市', '结算详情']}}}
2026-01-19 16:03:33,330 - main.py[line:166] - INFO - 二级场景判断结果：{'status_code': 200, 'secondary_scene': '地域流量分析', 'prompt': '', 'intermediate_result': {'keywords': ['地市', '025.11.29', '结算详情', '025.10.1'], 'attributes': {'源端': ['025.10.1', '025.11.29', '省内', '地市', '结算详情'], '对端': ['025.11.29', '省内', '地市', '结算详情']}}}
2026-01-19 16:03:33,331 - main.py[line:212] - INFO - 二级场景已确定，进入三级场景判断
2026-01-19 16:03:33,331 - main.py[line:212] - INFO - 二级场景已确定，进入三级场景判断
2026-01-19 16:03:33,331 - main.py[line:224] - INFO - 三级场景判断结果：{'status_code': 203, 'second_scene': '地域流量分析', 'third_scene_candidates': [{'name': '地市', 'raw': 100, 'score': 1.0, 'matched': ['scene_name_match', 'city_keyword']}, {'name': '网段', 'raw': 80, 'score': 0.8, 'matched': ['segment_keyword']}, {'name': '省内', 'raw': 50, 'score': 0.5, 'matched': ['scene_name_match']}, {'name': 'IP', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '端口', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '路由器', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': 'CR路由器', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '客户', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '账号', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '省际', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '省外', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '跨省', 'raw': 0, 'score': 0.0, 'matched': []}], 'chosen_third_scene': '地市', 'confidence': 1.0, 'intermediate_result': {'keywords': ['地市', '025.11.29', '结算详情', '025.10.1'], 'attributes': {'源端': ['025.10.1', '025.11.29', '省内', '地市', '结算详情'], '对端': ['025.11.29', '省内', '地市', '结算详情']}}, 'prompt': '已确认您关注的是地市场景，请提供相关参数继续分析。', 'description': '通过规则匹配成功识别到三级场景：地市，置信度：1.00', 'analysis_details': {'rule_matched': True, 'llm_used': False, 'llm_valid': True, 'candidate_count': 12, 'threshold': 0.5, 'valid_third_scenes': ['IP', '端口', '网段', '路由器', 'CR路由器', '客户', '账号', '地市', '省际', '省外', '省内', '跨省']}}
2026-01-19 16:03:33,331 - main.py[line:224] - INFO - 三级场景判断结果：{'status_code': 203, 'second_scene': '地域流量分析', 'third_scene_candidates': [{'name': '地市', 'raw': 100, 'score': 1.0, 'matched': ['scene_name_match', 'city_keyword']}, {'name': '网段', 'raw': 80, 'score': 0.8, 'matched': ['segment_keyword']}, {'name': '省内', 'raw': 50, 'score': 0.5, 'matched': ['scene_name_match']}, {'name': 'IP', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '端口', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '路由器', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': 'CR路由器', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '客户', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '账号', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '省际', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '省外', 'raw': 0, 'score': 0.0, 'matched': []}, {'name': '跨省', 'raw': 0, 'score': 0.0, 'matched': []}], 'chosen_third_scene': '地市', 'confidence': 1.0, 'intermediate_result': {'keywords': ['地市', '025.11.29', '结算详情', '025.10.1'], 'attributes': {'源端': ['025.10.1', '025.11.29', '省内', '地市', '结算详情'], '对端': ['025.11.29', '省内', '地市', '结算详情']}}, 'prompt': '已确认您关注的是地市场景，请提供相关参数继续分析。', 'description': '通过规则匹配成功识别到三级场景：地市，置信度：1.00', 'analysis_details': {'rule_matched': True, 'llm_used': False, 'llm_valid': True, 'candidate_count': 12, 'threshold': 0.5, 'valid_third_scenes': ['IP', '端口', '网段', '路由器', 'CR路由器', '客户', '账号', '地市', '省际', '省外', '省内', '跨省']}}
2026-01-19 16:03:33,331 - main.py[line:242] - INFO - 三级场景已确定，提取属性并检查缺失属性
2026-01-19 16:03:33,331 - main.py[line:242] - INFO - 三级场景已确定，提取属性并检查缺失属性
2026-01-19 16:03:33,333 - main.py[line:247] - INFO - 属性提取结果：{'源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '对端': '', '源端类型': 'IDC+MAN', '对端类型': '', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '流向': '流出', '数据类型': '流量总值', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '模糊匹配': False, '上行下行': '上行', '补充信息': '详情数据'}
2026-01-19 16:03:33,333 - main.py[line:247] - INFO - 属性提取结果：{'源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '对端': '', '源端类型': 'IDC+MAN', '对端类型': '', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '流向': '流出', '数据类型': '流量总值', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '模糊匹配': False, '上行下行': '上行', '补充信息': '详情数据'}
2026-01-19 16:03:33,333 - main.py[line:251] - INFO - 属性检查结果：{'missing': ['对端'], 'prompt': '麻烦补充下对端信息（如：省外、省内、或特定对象）。', 'has_missing': True}
2026-01-19 16:03:33,333 - main.py[line:251] - INFO - 属性检查结果：{'missing': ['对端'], 'prompt': '麻烦补充下对端信息（如：省外、省内、或特定对象）。', 'has_missing': True}
2026-01-19 16:03:33,333 - main.py[line:255] - INFO - 有缺失属性，生成引导问题
2026-01-19 16:03:33,333 - main.py[line:255] - INFO - 有缺失属性，生成引导问题
2026-01-19 16:03:33,333 - main.py[line:859] - INFO - 算法处理分析用户问题耗时:4.67s
2026-01-19 16:03:33,333 - main.py[line:859] - INFO - 算法处理分析用户问题耗时:4.67s
127.0.0.1 - - [19/Jan/2026 16:03:33] "POST /algorithm/analyze HTTP/1.1" 200 -
2026-01-19 16:03:33,334 - data_source.py[line:57] - INFO - 算法与后端交互接口耗时:4.678895950317383
2026-01-19 16:03:33,334 - data_source.py[line:57] - INFO - 算法与后端交互接口耗时:4.678895950317383
2026-01-19 16:03:33,334 - backend_server.py[line:82] - INFO - 算法返回值：{'analysis_result': '麻烦补充下对端信息（如：省外、省内、或特定对象）。', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'is_new_task': True, 'primary_scene': '流量流向分析', 'questions': [], 'secondary_scene': '地域流量分析', 'session_id': '11111111111111', 'status_code': 202, 'third_scene': '地市', 'third_scene_confidence': 1.0}
2026-01-19 16:03:33,334 - backend_server.py[line:82] - INFO - 算法返回值：{'analysis_result': '麻烦补充下对端信息（如：省外、省内、或特定对象）。', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'is_new_task': True, 'primary_scene': '流量流向分析', 'questions': [], 'secondary_scene': '地域流量分析', 'session_id': '11111111111111', 'status_code': 202, 'third_scene': '地市', 'third_scene_confidence': 1.0}
2026-01-19 16:03:33,334 - backend_server.py[line:101] - INFO - 后端处理用户问题耗时:4.68s
2026-01-19 16:03:33,334 - backend_server.py[line:101] - INFO - 后端处理用户问题耗时:4.68s
127.0.0.1 - - [19/Jan/2026 16:03:33] "POST /task/process HTTP/1.1" 200 -
2026-01-19 16:03:33,336 - data_source.py[line:92] - INFO - 前后端交互接口耗时:4.6904072761535645
2026-01-19 16:03:33,336 - data_source.py[line:92] - INFO - 前后端交互接口耗时:4.6904072761535645
2026-01-19 16:03:52,304 - backend_server.py[line:28] - INFO - 请求体：{'session_id': '11111111111111', 'status_code': 202, 'user_input': '省外', 'history_input': [{'role': 'assistant', 'content': '有什么可以帮你的吗？'}, {'role': 'user', 'content': '查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据\n\n'}, {'role': 'assistant', 'content': "{'analysis_result': '麻烦补充下对端信息（如：省外、省内、或特定对象）。', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'is_new_task': True, 'primary_scene': '流量流向分析', 'questions': [], 'secondary_scene': '地域流量分析', 'session_id': '11111111111111', 'status_code': 202, 'third_scene': '地市', 'third_scene_confidence': 1.0}"}], 'primary_scene': '流量流向分析', 'secondary_scene': '地域流量分析', 'third_scene': '地市', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}}
2026-01-19 16:03:52,304 - backend_server.py[line:28] - INFO - 请求体：{'session_id': '11111111111111', 'status_code': 202, 'user_input': '省外', 'history_input': [{'role': 'assistant', 'content': '有什么可以帮你的吗？'}, {'role': 'user', 'content': '查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据\n\n'}, {'role': 'assistant', 'content': "{'analysis_result': '麻烦补充下对端信息（如：省外、省内、或特定对象）。', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'is_new_task': True, 'primary_scene': '流量流向分析', 'questions': [], 'secondary_scene': '地域流量分析', 'session_id': '11111111111111', 'status_code': 202, 'third_scene': '地市', 'third_scene_confidence': 1.0}"}], 'primary_scene': '流量流向分析', 'secondary_scene': '地域流量分析', 'third_scene': '地市', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}}
2026-01-19 16:03:52,309 - main.py[line:67] - INFO - 请求体：{'session_id': '11111111111111', 'status_code': 202, 'user_input': '省外', 'history_input': [{'role': 'assistant', 'content': '有什么可以帮你的吗？'}, {'role': 'user', 'content': '查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据\n\n'}, {'role': 'assistant', 'content': "{'analysis_result': '麻烦补充下对端信息（如：省外、省内、或特定对象）。', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'is_new_task': True, 'primary_scene': '流量流向分析', 'questions': [], 'secondary_scene': '地域流量分析', 'session_id': '11111111111111', 'status_code': 202, 'third_scene': '地市', 'third_scene_confidence': 1.0}"}], 'primary_scene': '流量流向分析', 'secondary_scene': '地域流量分析', 'third_scene': '地市', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'questions': [], 'time': ''}
2026-01-19 16:03:52,309 - main.py[line:67] - INFO - 请求体：{'session_id': '11111111111111', 'status_code': 202, 'user_input': '省外', 'history_input': [{'role': 'assistant', 'content': '有什么可以帮你的吗？'}, {'role': 'user', 'content': '查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据\n\n'}, {'role': 'assistant', 'content': "{'analysis_result': '麻烦补充下对端信息（如：省外、省内、或特定对象）。', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'is_new_task': True, 'primary_scene': '流量流向分析', 'questions': [], 'secondary_scene': '地域流量分析', 'session_id': '11111111111111', 'status_code': 202, 'third_scene': '地市', 'third_scene_confidence': 1.0}"}], 'primary_scene': '流量流向分析', 'secondary_scene': '地域流量分析', 'third_scene': '地市', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'questions': [], 'time': ''}
2026-01-19 16:03:52,310 - main.py[line:96] - INFO - 当前关键词：[]，历史关键词：[]
2026-01-19 16:03:52,310 - main.py[line:96] - INFO - 当前关键词：[]，历史关键词：[]
2026-01-19 16:03:52,310 - main.py[line:98] - INFO - 叠加后的关键词：[]
2026-01-19 16:03:52,310 - main.py[line:98] - INFO - 叠加后的关键词：[]
2026-01-19 16:03:52,310 - main.py[line:102] - INFO - 当前状态码：202，用户输入：省外
2026-01-19 16:03:52,310 - main.py[line:102] - INFO - 当前状态码：202，用户输入：省外
2026-01-19 16:03:55,551 - main.py[line:126] - INFO - 闲聊检测结果：非闲聊
2026-01-19 16:03:55,551 - main.py[line:126] - INFO - 闲聊检测结果：非闲聊
2026-01-19 16:03:56,461 - main.py[line:135] - INFO - 新任务判断结果：延续任务
2026-01-19 16:03:56,461 - main.py[line:135] - INFO - 新任务判断结果：延续任务
2026-01-19 16:03:56,462 - primary_scene_classification.py[line:125] - INFO - 开始一级场景分类，用户输入：省外，历史对话：[{'role': 'assistant', 'content': '有什么可以帮你的吗？'}, {'role': 'user', 'content': '查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据\n\n'}, {'role': 'assistant', 'content': "{'analysis_result': '麻烦补充下对端信息（如：省外、省内、或特定对象）。', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'is_new_task': True, 'primary_scene': '流量流向分析', 'questions': [], 'secondary_scene': '地域流量分析', 'session_id': '11111111111111', 'status_code': 202, 'third_scene': '地市', 'third_scene_confidence': 1.0}"}]
2026-01-19 16:03:56,462 - primary_scene_classification.py[line:125] - INFO - 开始一级场景分类，用户输入：省外，历史对话：[{'role': 'assistant', 'content': '有什么可以帮你的吗？'}, {'role': 'user', 'content': '查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据\n\n'}, {'role': 'assistant', 'content': "{'analysis_result': '麻烦补充下对端信息（如：省外、省内、或特定对象）。', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'is_new_task': True, 'primary_scene': '流量流向分析', 'questions': [], 'secondary_scene': '地域流量分析', 'session_id': '11111111111111', 'status_code': 202, 'third_scene': '地市', 'third_scene_confidence': 1.0}"}]
2026-01-19 16:03:56,462 - primary_scene_classification.py[line:129] - INFO - 场景映射配置：{'流量流向分析': ['地域流量分析', '客户流量分析', 'IP流量分析'], '异常流量分析': ['PCDN流量分析', '白手套流量分析', '拉流流量分析'], '流量成分分析': ['应用流量分析', '云业务流量分析', '异网IDC资源分析', '客户流量成分分析'], '闲聊': ['闲聊']}
2026-01-19 16:03:56,462 - primary_scene_classification.py[line:129] - INFO - 场景映射配置：{'流量流向分析': ['地域流量分析', '客户流量分析', 'IP流量分析'], '异常流量分析': ['PCDN流量分析', '白手套流量分析', '拉流流量分析'], '流量成分分析': ['应用流量分析', '云业务流量分析', '异网IDC资源分析', '客户流量成分分析'], '闲聊': ['闲聊']}
2026-01-19 16:03:56,968 - primary_scene_classification.py[line:141] - INFO - 大模型返回结果：流量流向分析
2026-01-19 16:03:56,968 - primary_scene_classification.py[line:141] - INFO - 大模型返回结果：流量流向分析
2026-01-19 16:03:56,969 - primary_scene_classification.py[line:159] - INFO - 一级场景分类结果：流量流向分析
2026-01-19 16:03:56,969 - primary_scene_classification.py[line:159] - INFO - 一级场景分类结果：流量流向分析
2026-01-19 16:03:56,969 - main.py[line:140] - INFO - 一级场景分类结果：流量流向分析
2026-01-19 16:03:56,969 - main.py[line:140] - INFO - 一级场景分类结果：流量流向分析
2026-01-19 16:03:56,969 - main.py[line:590] - INFO - 处理任务字段补全
2026-01-19 16:03:56,969 - main.py[line:590] - INFO - 处理任务字段补全
2026-01-19 16:03:56,969 - main.py[line:614] - INFO - 已有的属性：{'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}
2026-01-19 16:03:56,969 - main.py[line:614] - INFO - 已有的属性：{'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}
2026-01-19 16:03:56,973 - main.py[line:618] - INFO - 智能合并后的属性：{'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '省外', '对端类型': 'IDC+MAN', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}
2026-01-19 16:03:56,973 - main.py[line:618] - INFO - 智能合并后的属性：{'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '省外', '对端类型': 'IDC+MAN', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}
2026-01-19 16:03:56,974 - main.py[line:622] - INFO - 属性检查结果：{'missing': [], 'prompt': '', 'has_missing': False}
2026-01-19 16:03:56,974 - main.py[line:644] - INFO - 所有必要属性都已完整，进入问题生成
2026-01-19 16:03:56,974 - main.py[line:622] - INFO - 属性检查结果：{'missing': [], 'prompt': '', 'has_missing': False}
2026-01-19 16:03:56,974 - main.py[line:644] - INFO - 所有必要属性都已完整，进入问题生成
2026-01-19 16:03:56,977 - fill_template_pipeline_service.py[line:722] - INFO - rules_json: {"rule_extracted": {"direction": ["流出"], "source_type": "MAN和IDC", "destination_type": "MAN和IDC"}, "rule_evidence": {"direction": "matched:流出", "source_type": "matched:['MAN', 'IDC']", "destination_type": "matched:['MAN', 'IDC']"}}
2026-01-19 16:03:56,977 - fill_template_pipeline_service.py[line:722] - INFO - rules_json: {"rule_extracted": {"direction": ["流出"], "source_type": "MAN和IDC", "destination_type": "MAN和IDC"}, "rule_evidence": {"direction": "matched:流出", "source_type": "matched:['MAN', 'IDC']", "destination_type": "matched:['MAN', 'IDC']"}}
2026-01-19 16:03:56,978 - fill_template_pipeline_service.py[line:723] - INFO - keywords: []
2026-01-19 16:03:56,978 - fill_template_pipeline_service.py[line:723] - INFO - keywords: []
2026-01-19 16:03:56,978 - fill_template_pipeline_service.py[line:724] - INFO - history: [{'role': 'assistant', 'content': '有什么可以帮你的吗？'}, {'role': 'user', 'content': '查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据\n\n'}, {'role': 'assistant', 'content': "{'analysis_result': '麻烦补充下对端信息（如：省外、省内、或特定对象）。', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'is_new_task': True, 'primary_scene': '流量流向分析', 'questions': [], 'secondary_scene': '地域流量分析', 'session_id': '11111111111111', 'status_code': 202, 'third_scene': '地市', 'third_scene_confidence': 1.0}"}]
2026-01-19 16:03:56,978 - fill_template_pipeline_service.py[line:724] - INFO - history: [{'role': 'assistant', 'content': '有什么可以帮你的吗？'}, {'role': 'user', 'content': '查询2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市结算详情数据\n\n'}, {'role': 'assistant', 'content': "{'analysis_result': '麻烦补充下对端信息（如：省外、省内、或特定对象）。', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '', '对端类型': '', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'is_new_task': True, 'primary_scene': '流量流向分析', 'questions': [], 'secondary_scene': '地域流量分析', 'session_id': '11111111111111', 'status_code': 202, 'third_scene': '地市', 'third_scene_confidence': 1.0}"}]
2026-01-19 16:03:56,978 - fill_template_pipeline_service.py[line:725] - INFO - user_input: 省外
2026-01-19 16:03:56,978 - fill_template_pipeline_service.py[line:725] - INFO - user_input: 省外
2026-01-19 16:03:56,978 - fill_template_pipeline_service.py[line:726] - INFO - api_key: sk-39686688fe5b4aa39446d271b248d7b9
2026-01-19 16:03:56,978 - fill_template_pipeline_service.py[line:726] - INFO - api_key: sk-39686688fe5b4aa39446d271b248d7b9
/Users/kcol/Downloads/work/code/chatBI-1.1.0-develop/service/fill_template_pipeline_service.py:727: LangChainDeprecationWarning: The method `Chain.run` was deprecated in langchain-classic 0.1.0 and will be removed in 1.0. Use `invoke` instead.
  raw = chain.run(history=history, current_input=user_input or "", keywords=",".join(keywords or []), rules_evidence=rules_json)
2026-01-19 16:04:08,495 - fill_template_pipeline_service.py[line:1050] - INFO - 构建模板结果: 查询2025.10.1到2025.11.29内，省内各地市到省外的流量流速，源端类型为IDC+MAN，对端类型为MAN和IDC，流量单位为Gbps，统计方式为按均值统计，要求按均值统计并且按类型进行细分统计，上行流量
2026-01-19 16:04:08,495 - fill_template_pipeline_service.py[line:1050] - INFO - 构建模板结果: 查询2025.10.1到2025.11.29内，省内各地市到省外的流量流速，源端类型为IDC+MAN，对端类型为MAN和IDC，流量单位为Gbps，统计方式为按均值统计，要求按均值统计并且按类型进行细分统计，上行流量
2026-01-19 16:04:08,497 - fill_template_pipeline_service.py[line:1089] - INFO - 原问题: 查询2025.10.1到2025.11.29内，省内各地市到省外的流量流速，源端类型为IDC+MAN，对端类型为MAN和IDC，流量单位为Gbps，统计方式为按均值统计，要求按均值统计并且按类型进行细分统计，上行流量
2026-01-19 16:04:08,497 - fill_template_pipeline_service.py[line:1089] - INFO - 原问题: 查询2025.10.1到2025.11.29内，省内各地市到省外的流量流速，源端类型为IDC+MAN，对端类型为MAN和IDC，流量单位为Gbps，统计方式为按均值统计，要求按均值统计并且按类型进行细分统计，上行流量
2026-01-19 16:04:14,597 - main.py[line:658] - INFO - 问题生成结果：{'status_code': 200, 'secondary_scene': '地域流量分析', 'third_scene': '地市', 'template_fields': {'secondary_scene': '地域流量分析', 'third_scene': '地市', 'keywords': [], 'source': '省内各地市', 'destination': '省外', 'time_range': '2025.10.1到2025.11.29', 'source_type': 'IDC+MAN', 'destination_type': 'MAN和IDC', 'speed_unit': 'Gbps', 'requirement1': '按均值统计', 'requirement2': '按类型进行细分统计', 'metric': '流量流速', 'aggregation': '按均值统计', 'exclude_conditions': '', 'up_down': '上行', 'time_granularity': '', 'data_type': '', 'supplementary_info': ''}, 'filled_question': '查询2025.10.1到2025.11.29内，省内各地市到省外的流量流速，源端类型为IDC+MAN，对端类型为MAN和IDC，流量单位为Gbps，统计方式为按均值统计，要求按均值统计并且按类型进行细分统计，上行流量', 'rewrites': ['查询从2025年10月1日至2025年11月29日期间，省内各地市到省外的上行流量流速，源端类型包括IDC和城域网，对端类型为城域网和IDC，单位是Gbps，并且要求按均值统计同时按类型细分统计。'], 'merged': {'merged': {'direction': {'value': '流出', 'source': 'merged', 'confidence': 0.9, 'rule_val': ['流出'], 'llm_val': '流出'}, 'breakdown': {'value': None, 'source': 'none', 'confidence': 0.0, 'rule_val': None, 'llm_val': ''}, 'aggregation': {'value': None, 'source': 'none', 'confidence': 0.0, 'rule_val': None, 'llm_val': ''}, 'destination_type': {'value': 'MAN和IDC', 'source': 'merged', 'confidence': 0.8, 'rule_val': 'MAN和IDC', 'llm_val': 'MAN和IDC'}, 'source': {'value': '省内各地市', 'source': 'llm', 'confidence': 0.8, 'rule_val': None, 'llm_val': '省内各地市'}, 'time_range': {'value': '2025.10.1到2025.11.29', 'source': 'llm', 'confidence': 0.9, 'rule_val': None, 'llm_val': '2025.10.1到2025.11.29'}, 'destination': {'value': '省外', 'source': 'llm', 'confidence': 0.9, 'rule_val': None, 'llm_val': '省外'}, 'requirement2': {'value': None, 'source': 'none', 'confidence': 0.0, 'rule_val': None, 'llm_val': None}, 'source_type': {'value': 'IDC+MAN', 'source': 'merged', 'confidence': 0.9, 'rule_val': 'MAN和IDC', 'llm_val': 'IDC+MAN'}, 'metric': {'value': None, 'source': 'none', 'confidence': 0.0, 'rule_val': None, 'llm_val': ''}, 'speed_unit': {'value': None, 'source': 'none', 'confidence': 0.0, 'rule_val': None, 'llm_val': ''}}, 'conflicts': {}, 'status': 'ok', 'clarify_prompt': '', 'audit': {'rule_res': {'extracted': {'direction': ['流出'], 'source_type': 'MAN和IDC', 'destination_type': 'MAN和IDC'}, 'confidence': {'direction': 0.8, 'source_type': 0.8, 'destination_type': 0.8}, 'evidence': {'direction': 'matched:流出', 'source_type': "matched:['MAN', 'IDC']", 'destination_type': "matched:['MAN', 'IDC']"}}, 'llm_res': {'extracted': {'source': '省内各地市', 'destination': '省外', 'source_type': 'IDC+MAN', 'destination_type': 'MAN和IDC', 'time_range': '2025.10.1到2025.11.29', 'direction': '流出', 'speed_unit': '', 'aggregation': '', 'breakdown': '', 'metric': ''}, 'confidence': {'source': 0.8, 'destination': 0.9, 'source_type': 0.9, 'destination_type': 0.8, 'time_range': 0.9, 'direction': 0.9, 'speed_unit': 0.0, 'aggregation': 0.0, 'breakdown': 0.0, 'metric': 0.0}, 'evidence': {'source': "从'源端'提取：2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据", 'destination': '当前输入直接提供：省外', 'source_type': "从'源端类型'提取：IDC+MAN", 'destination_type': "规则证据匹配：matched:['MAN', 'IDC']", 'time_range': "从'时间'提取：2025-10-1到2025-11-29", 'direction': '规则证据匹配：matched:流出', 'speed_unit': '', 'aggregation': '', 'breakdown': '', 'metric': ''}, 'raw': '{\n  "extracted": { \n    "source":"省内各地市", \n    "destination":"省外", \n    "source_type":"IDC+MAN", \n    "destination_type":"MAN和IDC", \n    "time_range":"2025.10.1到2025.11.29", \n    "direction":"流出", \n    "speed_unit":"", \n    "aggregation":"", \n    "breakdown":"", \n    "metric":"" \n  },\n  "confidence": { \n    "source": 0.8, \n    "destination": 0.9, \n    "source_type": 0.9, \n    "destination_type": 0.8, \n    "time_range": 0.9, \n    "direction": 0.9, \n    "speed_unit": 0.0, \n    "aggregation": 0.0, \n    "breakdown": 0.0, \n    "metric": 0.0 \n  },\n  "evidence": { \n    "source":"从\'源端\'提取：2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据", \n    "destination":"当前输入直接提供：省外", \n    "source_type":"从\'源端类型\'提取：IDC+MAN", \n    "destination_type":"规则证据匹配：matched:[\'MAN\', \'IDC\']", \n    "time_range":"从\'时间\'提取：2025-10-1到2025-11-29", \n    "direction":"规则证据匹配：matched:流出", \n    "speed_unit":"", \n    "aggregation":"", \n    "breakdown":"", \n    "metric":"" \n  }\n}'}}}}
2026-01-19 16:04:14,597 - main.py[line:658] - INFO - 问题生成结果：{'status_code': 200, 'secondary_scene': '地域流量分析', 'third_scene': '地市', 'template_fields': {'secondary_scene': '地域流量分析', 'third_scene': '地市', 'keywords': [], 'source': '省内各地市', 'destination': '省外', 'time_range': '2025.10.1到2025.11.29', 'source_type': 'IDC+MAN', 'destination_type': 'MAN和IDC', 'speed_unit': 'Gbps', 'requirement1': '按均值统计', 'requirement2': '按类型进行细分统计', 'metric': '流量流速', 'aggregation': '按均值统计', 'exclude_conditions': '', 'up_down': '上行', 'time_granularity': '', 'data_type': '', 'supplementary_info': ''}, 'filled_question': '查询2025.10.1到2025.11.29内，省内各地市到省外的流量流速，源端类型为IDC+MAN，对端类型为MAN和IDC，流量单位为Gbps，统计方式为按均值统计，要求按均值统计并且按类型进行细分统计，上行流量', 'rewrites': ['查询从2025年10月1日至2025年11月29日期间，省内各地市到省外的上行流量流速，源端类型包括IDC和城域网，对端类型为城域网和IDC，单位是Gbps，并且要求按均值统计同时按类型细分统计。'], 'merged': {'merged': {'direction': {'value': '流出', 'source': 'merged', 'confidence': 0.9, 'rule_val': ['流出'], 'llm_val': '流出'}, 'breakdown': {'value': None, 'source': 'none', 'confidence': 0.0, 'rule_val': None, 'llm_val': ''}, 'aggregation': {'value': None, 'source': 'none', 'confidence': 0.0, 'rule_val': None, 'llm_val': ''}, 'destination_type': {'value': 'MAN和IDC', 'source': 'merged', 'confidence': 0.8, 'rule_val': 'MAN和IDC', 'llm_val': 'MAN和IDC'}, 'source': {'value': '省内各地市', 'source': 'llm', 'confidence': 0.8, 'rule_val': None, 'llm_val': '省内各地市'}, 'time_range': {'value': '2025.10.1到2025.11.29', 'source': 'llm', 'confidence': 0.9, 'rule_val': None, 'llm_val': '2025.10.1到2025.11.29'}, 'destination': {'value': '省外', 'source': 'llm', 'confidence': 0.9, 'rule_val': None, 'llm_val': '省外'}, 'requirement2': {'value': None, 'source': 'none', 'confidence': 0.0, 'rule_val': None, 'llm_val': None}, 'source_type': {'value': 'IDC+MAN', 'source': 'merged', 'confidence': 0.9, 'rule_val': 'MAN和IDC', 'llm_val': 'IDC+MAN'}, 'metric': {'value': None, 'source': 'none', 'confidence': 0.0, 'rule_val': None, 'llm_val': ''}, 'speed_unit': {'value': None, 'source': 'none', 'confidence': 0.0, 'rule_val': None, 'llm_val': ''}}, 'conflicts': {}, 'status': 'ok', 'clarify_prompt': '', 'audit': {'rule_res': {'extracted': {'direction': ['流出'], 'source_type': 'MAN和IDC', 'destination_type': 'MAN和IDC'}, 'confidence': {'direction': 0.8, 'source_type': 0.8, 'destination_type': 0.8}, 'evidence': {'direction': 'matched:流出', 'source_type': "matched:['MAN', 'IDC']", 'destination_type': "matched:['MAN', 'IDC']"}}, 'llm_res': {'extracted': {'source': '省内各地市', 'destination': '省外', 'source_type': 'IDC+MAN', 'destination_type': 'MAN和IDC', 'time_range': '2025.10.1到2025.11.29', 'direction': '流出', 'speed_unit': '', 'aggregation': '', 'breakdown': '', 'metric': ''}, 'confidence': {'source': 0.8, 'destination': 0.9, 'source_type': 0.9, 'destination_type': 0.8, 'time_range': 0.9, 'direction': 0.9, 'speed_unit': 0.0, 'aggregation': 0.0, 'breakdown': 0.0, 'metric': 0.0}, 'evidence': {'source': "从'源端'提取：2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据", 'destination': '当前输入直接提供：省外', 'source_type': "从'源端类型'提取：IDC+MAN", 'destination_type': "规则证据匹配：matched:['MAN', 'IDC']", 'time_range': "从'时间'提取：2025-10-1到2025-11-29", 'direction': '规则证据匹配：matched:流出', 'speed_unit': '', 'aggregation': '', 'breakdown': '', 'metric': ''}, 'raw': '{\n  "extracted": { \n    "source":"省内各地市", \n    "destination":"省外", \n    "source_type":"IDC+MAN", \n    "destination_type":"MAN和IDC", \n    "time_range":"2025.10.1到2025.11.29", \n    "direction":"流出", \n    "speed_unit":"", \n    "aggregation":"", \n    "breakdown":"", \n    "metric":"" \n  },\n  "confidence": { \n    "source": 0.8, \n    "destination": 0.9, \n    "source_type": 0.9, \n    "destination_type": 0.8, \n    "time_range": 0.9, \n    "direction": 0.9, \n    "speed_unit": 0.0, \n    "aggregation": 0.0, \n    "breakdown": 0.0, \n    "metric": 0.0 \n  },\n  "evidence": { \n    "source":"从\'源端\'提取：2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据", \n    "destination":"当前输入直接提供：省外", \n    "source_type":"从\'源端类型\'提取：IDC+MAN", \n    "destination_type":"规则证据匹配：matched:[\'MAN\', \'IDC\']", \n    "time_range":"从\'时间\'提取：2025-10-1到2025-11-29", \n    "direction":"规则证据匹配：matched:流出", \n    "speed_unit":"", \n    "aggregation":"", \n    "breakdown":"", \n    "metric":"" \n  }\n}'}}}}
2026-01-19 16:04:14,598 - main.py[line:859] - INFO - 算法处理分析用户问题耗时:22.29s
2026-01-19 16:04:14,598 - main.py[line:859] - INFO - 算法处理分析用户问题耗时:22.29s
127.0.0.1 - - [19/Jan/2026 16:04:14] "POST /algorithm/analyze HTTP/1.1" 200 -
2026-01-19 16:04:14,605 - data_source.py[line:57] - INFO - 算法与后端交互接口耗时:22.30040216445923
2026-01-19 16:04:14,606 - backend_server.py[line:82] - INFO - 算法返回值：{'analysis_result': '问题生成，请用户确认', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '省外', '对端类型': 'IDC+MAN', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'is_new_task': False, 'primary_scene': '流量流向分析', 'questions': ['查询从2025年10月1日至2025年11月29日期间，省内各地市到省外的上行流量流速，源端类型包括IDC和城域网，对端类型为城域网和IDC，单位是Gbps，并且要求按均值统计同时按类型细分统计。'], 'secondary_scene': '地域流量分析', 'session_id': '11111111111111', 'status_code': 203, 'third_scene': '地市'}
2026-01-19 16:04:14,605 - data_source.py[line:57] - INFO - 算法与后端交互接口耗时:22.30040216445923
2026-01-19 16:04:14,606 - backend_server.py[line:82] - INFO - 算法返回值：{'analysis_result': '问题生成，请用户确认', 'intermediate_result': {'attributes': {'上行下行': '上行', '剔除条件': ['天翼云', '天翼看家后省内各地市结算详情数据'], '对端': '省外', '对端类型': 'IDC+MAN', '数据类型': '流量总值', '时间': '2025-10-1到2025-11-29', '时间粒度': '全部', '模糊匹配': False, '流向': '流出', '源端': '2025.10.1到2025.11.29剔除天翼云和天翼看家后省内各地市数据', '源端类型': 'IDC+MAN', '补充信息': '详情数据'}, 'keywords': [], 'missing_attributes': ['对端']}, 'is_new_task': False, 'primary_scene': '流量流向分析', 'questions': ['查询从2025年10月1日至2025年11月29日期间，省内各地市到省外的上行流量流速，源端类型包括IDC和城域网，对端类型为城域网和IDC，单位是Gbps，并且要求按均值统计同时按类型细分统计。'], 'secondary_scene': '地域流量分析', 'session_id': '11111111111111', 'status_code': 203, 'third_scene': '地市'}
2026-01-19 16:04:14,606 - backend_server.py[line:101] - INFO - 后端处理用户问题耗时:22.30s
2026-01-19 16:04:14,606 - backend_server.py[line:101] - INFO - 后端处理用户问题耗时:22.30s
127.0.0.1 - - [19/Jan/2026 16:04:14] "POST /task/process HTTP/1.1" 200 -
2026-01-19 16:04:14,612 - data_source.py[line:92] - INFO - 前后端交互接口耗时:22.314514875411987
2026-01-19 16:04:14,612 - data_source.py[line:92] - INFO - 前后端交互接口耗时:22.314514875411987
